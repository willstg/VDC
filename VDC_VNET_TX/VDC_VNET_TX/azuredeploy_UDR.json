{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {

    "baseUrl": {
      "defaultValue": "https://github.com/willstg/VDC/tree/master/VDC_VNET_TX/VDC_VNET_TX",
      "type": "string",
      "metadata": {
        "artifactsBaseUrl": "",
        "description": "URL to acquire other templates"
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "southcentralus",
      "metadata": {
        "description": "Deployment location. (example: southcentralus)"
      }
    },

    "ResourceGroupName": {
      "type": "string",
      "defaultValue": "vdc_vnet_tx"
    },
    "VNETStorageName": {
      "type": "string",
      "defaultvalue": "vdcvnettx1a",
      "metadata": {
        "description": "Storage account name"
      }
    },
    "stdStorageType": {
      "type": "string",
      "defaultValue": "Standard_LRS",
      "allowedValues": [
        "Standard_LRS",
        "Standard_GRS",
        "Standard_ZRS"
      ],
      "metadata": {
        "description": "Storage account type"
      }
    },
    "VNETPremiumStorageName": {
      "type": "string",
      "defaultValue": "vdcvnettx2a",
      "metadata": {
        "description": "Premium Storage account name"
      }
    },
    "prmStorageType": {
      "type": "string",
      "defaultValue": "Premium_LRS",
      "allowedValues": [
        "Premium_LRS",
        "Premium_GRS",
        "Premium_ZRS"
      ],
      "metadata": {
        "description": "Premium Storage account type"
      }
    },
    "vnetName": {
      "type": "string",
      "defaultValue": "vnet_vdc_tx",
      "metadata": {
        "description": "AzureFoundation VNET for Virtual Data Center"
      }
    },
    "vnetAddressPrefix": {
      "type": "string",
      "defaultValue": "10.190.0.0/18",
      "metadata": {
        "description": "CIDR prefix for the VNet address space."
      }
    },
    "subnet700Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.0/29",
      "metadata": {
        "description": "Subnet for CSR for Inside interface"
      }
    },
    "subnet700Name": {
      "type": "string",
      "defaultValue": "CSR_In_700_VDC_prod_tx",
      "metadata": {
        "description": "Subnet for CSR for Inside interface"
      }
    },
    "subnet700NSG": {
      "type": "string",
      "defaultValue": "NSG_CSR_In_700_VDC_prod_tx",
      "metadata": {
        "description": "700: CSR_In, Tier (0) Subnet for CSR for Inside in"
      }
    },
    "subnet700VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.04",
      "metadata": {
        "description": "CSR_Out subnet 700 VNA IP"
      }
    },
    "subnet700UDR": {
      "type": "string",
      "defaultValue": "UDR_700_CSR_In",
      "metadata": {
        "description": "UDR 700: CSR_In"
      }
    },
    "subnet701Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.8/29",
      "metadata": {
        "description": "Subnet for CSR Out interface"
      }
    },
    "subnet701Name": {
      "type": "string",
      "defaultValue": "CSR_Out_701_VDC_prod_tx",
      "metadata": {
        "description": "Subnet for CSR Outside"
      }
    },
    "subnet701VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.12",
      "metadata": {
        "description": "CSR_Out subnet 701 VNA IP"
      }
    },
    "subnet701NSG": {
      "type": "string",
      "defaultValue": "NSG_CSR_Out_701_VDC_prod_tx",
      "metadata": {
        "description": "701: CSR_Out, Tier (0) Subnet for CSR for Outside"
      }
    },
    "subnet701UDR": {
      "type": "string",
      "defaultValue": "UDR_701_CSR_Out",
      "metadata": {
        "description": "UDR 701: CSR_Out"
      }
    },
    "subnet702Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.16/29",
      "metadata": {
        "description": "Subnet for CSR Tunnel interface"
      }
    },
    "subnet702Name": {
      "type": "string",
      "defaultValue": "CSR_Tunnel_702_VDC_prod_tx",
      "metadata": {
        "description": "Subnet for the CSR Tunnel"
      }
    },
    "subnet702NSG": {
      "type": "string",
      "defaultValue": "NSG_CSR_Tunnel_702_VDC_prod_tx",
      "metadata": {
        "description": "702: CSR_Tunnel, Tier (0) Subnet for the CSR Tunne"
      }
    },
    "subnet702VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.20",
      "metadata": {
        "description": "CSR_Tunnel subnet 702 VNA IP"
      }
    },
    "subnet702UDR": {
      "type": "string",
      "defaultValue": "UDR_702_CSR_Out",
      "metadata": {
        "description": "UDR 702: CSR_Out"
      }
    },
    "subnet703Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.24/29",
      "metadata": {
        "description": "Failover subnet"
      }
    },
    "subnet703Name": {
      "type": "string",
      "defaultValue": "CSR_HA_703_VDC_prod_tx",
      "metadata": {
        "description": "Failover subnet"
      }
    },
    "subnet703NSG": {
      "type": "string",
      "defaultValue": "NSG_CSR_HA_703_VDC_prod_tx",
      "metadata": {
        "description": "703: CSR_HA, Tier (0) Failover subnet"
      }
    },
    "subnet703VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.28",
      "metadata": {
        "description": "CSR_HA subnet 703 VNA IP"
      }
    },
    "subnet703UDR": {
      "type": "string",
      "defaultValue": "UDR_703_CSR_HA",
      "metadata": {
        "description": "UDR 703: CSR_HA"
      }
    },
    "subnet704Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.32/28",
      "metadata": {
        "description": "ExpressRoute Termination"
      }
    },
    "subnet704Name": {
      "type": "string",
      "defaultValue": "ER_704_VDC_Srvcs_TX",
      "metadata": {
        "description": "ASA trusted inside environment"
      }
    },
    "subnet704NSG": {
      "type": "string",
      "defaultValue": "NSG_ER_704_VDC_Srvcs_tx",
      "metadata": {
        "description": "704: ER, Tier (0) ExpressRoute Termination"
      }
    },
    "subnet101Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.64/29",
      "metadata": {
        "description": "ASA Management Interface"
      }
    },
    "subnet101Name": {
      "type": "string",
      "defaultValue": "IntASA_Mgnt_101_VDC_prod_TX",
      "metadata": {
        "description": "ASA management interface"
      }
    },
    "subnet101NSG": {
      "type": "string",
      "defaultValue": "NSG_IntASA_Mgnt_101_VDC_prod_TX",
      "metadata": {
        "description": "101: IntASA_Mgnt, Tier (0) ASA management interfac"
      }
    },
    "subnet101VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.68",
      "metadata": {
        "description": "IntASA_Mgnt subnet 101 VNA IP"
      }
    },
    "subnet101UDR": {
      "type": "string",
      "defaultValue": "UDR_101_ASA_Mgnt",
      "metadata": {
        "description": "UDR 101: ASA_Mgnt"
      }
    },
    "subnet102Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.72/29",
      "metadata": {
        "description": "ASA Inside Interface"
      }
    },
    "subnet102Name": {
      "type": "string",
      "defaultValue": "IntASA_In_102_VDC_prod_TX",
      "metadata": {
        "description": "ASA Inside Interface"
      }
    },
    "subnet102NSG": {
      "type": "string",
      "defaultValue": "NSG_IntASA_In_102_VDC_prod_TX",
      "metadata": {
        "description": "102: IntASA_In, Tier (0) ASA Inside Interface"
      }
    },
    "subnet102VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.76",
      "metadata": {
        "description": "IntASA_In subnet 102 VNA IP"
      }
    },
    "subnet102UDR": {
      "type": "string",
      "defaultValue": "UDR_102_ASA_In",
      "metadata": {
        "description": "UDR 102: ASA_In"
      }
    },
    "subnet103Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.80/29",
      "metadata": {
        "description": "ASA Outside Interface"

      }
    },
    "subnet103Name": {
      "type": "string",
      "defaultValue": "IntASA_Out_103_VDC_prod_TX",
      "metadata": {
        "description": "ASA Outside Interface"
      }
    },
    "subnet103NSG": {
      "type": "string",
      "defaultValue": "NSG_IntASA_Out_103_VDC_prod_TX",
      "metadata": {
        "description": "103: IntASA_Out, Tier (0) ASA Outside Interface"
      }
    },
    "subnet103VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.84",
      "metadata": {
        "description": "IntASA_Out subnet 103 VNA IP"
      }
    },
    "subnet103UDR": {
      "type": "string",
      "defaultValue": "UDR_103_ASA_Out",
      "metadata": {
        "description": "UDR 103: ASA_Out"
      }
    },
    "subnet104Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.80/29",
      "metadata": {
        "description": "ASA DMZ interface"
      }
    },
    "subnet104Name": {
      "type": "string",
      "defaultValue": "IntASA_DMZ_104_VDC_prod_TX",
      "metadata": {
        "description": "ASA DMZ interface"
      }
    },
    "subnet104NSG": {
      "type": "string",
      "defaultValue": "NSG_IntASA_DMZ_104_VDC_prod_TX",
      "metadata": {
        "description": "104: IntASA_Out, Tier (0) ASA Internet interface"
      }
    },
    "subnet104VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.92",
      "metadata": {
        "description": "IntASA_DMZ subnet 104 VNA IP"
      }
    },
    "subnet104UDR": {
      "type": "string",
      "defaultValue": "UDR_104_ASA_DMZ",
      "metadata": {
        "description": "UDR 104: ASA_DMZ"
      }
    },
    "subnet106Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.112/29",
      "metadata": {
        "description": "ASA management interface"
      }
    },
    "subnet106Name": {
      "type": "string",
      "defaultValue": "ExtASA_Mgnt_106_VDC_prod_TX",
      "metadata": {
        "description": "ASA management interface"
      }
    },
    "subnet106NSG": {
      "type": "string",
      "defaultValue": "NSG_ExtASA_Mgnt_106_VDC_prod_TX",
      "metadata": {
        "description": "\"106: ExtASA_Mgnt, Tier (0) ASA management interfac"
      }
    },
    "subnet106VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.116",
      "metadata": {
        "description": "IntASA_Mgnt subnet 106 VNA IP"
      }
    },
    "subnet106UDR": {
      "type": "string",
      "defaultValue": "UDR_106_ExtASA_Mgnt",
      "metadata": {
        "description": "UDR 106: ExtASA_Mgnt"
      }
    },
    "subnet107Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.120/29",
      "metadata": {
        "description": "ASA Inside Interface"
      }
    },
    "subnet107Name": {
      "type": "string",
      "defaultValue": "ExtASA_In_107_VDC_prod_TX",
      "metadata": {
        "description": "ASA Inside Interface"
      }
    },
    "subnet107NSG": {
      "type": "string",
      "defaultValue": "NSG_ExtASA_In_107_VDC_prod_TX",
      "metadata": {
        "description": "107: ExtASA_In, Tier (0) ASA Inside Interface"
      }
    },
    "subnet107VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.124",
      "metadata": {
        "description": "IntASA_In subnet 107 VNA IP"
      }
    },
    "subnet107UDR": {
      "type": "string",
      "defaultValue": "UDR_107_ExtASA_In",
      "metadata": {
        "description": "UDR 107: ExtASA_In"
      }
    },
    "subnet108Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.128/29",
      "metadata": {
        "description": "ASA Outside Interface"
      }
    },
    "subnet108Name": {
      "type": "string",
      "defaultValue": "ExtASA_Out_108_VDC_prod_TX",
      "metadata": {
        "description": "ASA Outside Interface"
      }
    },
    "subnet108NSG": {
      "type": "string",
      "defaultValue": "NSG_ExtASA_Out_108_VDC_prod_TX",
      "metadata": {
        "description": "108: ExtASA_Out, Tier (0) ASA Outside Interface"
      }
    },
    "subnet108VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.132",
      "metadata": {
        "description": "IntASA_Out subnet 108 VNA IP"
      }
    },
    "subnet108UDR": {
      "type": "string",
      "defaultValue": "UDR_108_ExtASA_Out",
      "metadata": {
        "description": "UDR 108: ExtASA_Out"
      }
    },
    "subnet109Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.136/29",
      "metadata": {
        "description": "ASA DMZ interface"
      }
    },
    "subnet109Name": {
      "type": "string",
      "defaultValue": "ExtASA_DMZ_109_VDC_prod_TX",
      "metadata": {
        "description": "ASA DMZ interface"
      }
    },
    "subnet109NSG": {
      "type": "string",
      "defaultValue": "NSG_ExtASA_DMZ_109_VDC_prod_TX",
      "metadata": {
        "description": "109: ExtASA_Out, Tier (0) ASA Internet interface"
      }
    },
    "subnet109VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.140",
      "metadata": {
        "description": "IntASA_DMZ subnet 109 VNA IP"
      }
    },
    "subnet109UDR": {
      "type": "string",
      "defaultValue": "UDR_109_ExtASA_DMZ",
      "metadata": {
        "description": "UDR 109: ExtASA_DMZ"
      }
    },
    "subnet111Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.96/29",
      "metadata": {
        "description": "Loadbalancer"
      }
    },
    "subnet111Name": {
      "type": "string",
      "defaultValue": "IntLB_111_VDC_prod_TX",
      "metadata": {
        "description": "Internal Loadbalancer Virtual Network Appliance"
      }
    },
    "subnet111NSG": {
      "type": "string",
      "defaultValue": "NSG_IntLB_111_VDC_prod_tx",
      "metadata": {
        "description": "111: IntLB, Tier (0) Loadbalancer"
      }
    },
    "subnet111VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.100",
      "metadata": {
        "description": "IntLB subnet 111 VNA IP"
      }
    },
    "subnet111UDR": {
      "type": "string",
      "defaultValue": "UDR_111_Int_LB",
      "metadata": {
        "description": "UDR 111: Int_LB"
      }
    },
    "subnet151Name": {
      "type": "string",
      "defaultValue": "ExtLB_151_VDC_prod_TX",
      "metadata": {
        "description": "Internal Loadbalancer virtual appliance"
      }
    },
    "subnet151Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.96/29",
      "metadata": {
        "description": "External Loadbalancer Virtual Network Appliance"
      }
    },
    "subnet151NSG": {
      "type": "string",
      "defaultValue": "NSG_ExtLB_151_VDC_prod_tx",
      "metadata": {
        "description": "151: ExtLB, Tier (0) Loadbalancer"
      }
    },
    "subnet151VNAIP": {
      "type": "string",
      "defaultValue": "10.190.0.148",
      "metadata": {
        "description": "ExtLB subnet 151 VNA IP"
      }
    },
    "subnet151UDR": {
      "type": "string",
      "defaultValue": "UDR_151_Ext_LB",
      "metadata": {
        "description": "UDR 151: Ext_LB"
      }
    },
    "subnet600Prefix": {
      "type": "string",
      "defaultValue": "10.190.56.0/24",
      "metadata": {
        "description": "Used to host highly sensitive data that is also highly accessed."
      }
    },
    "subnet600Name": {
      "type": "string",
      "defaultValue": "Services_600_VDC_Srvcs_tx",
      "metadata": {
        "description": "Used to host highly sensitive data that is also highly accessed."
      }
    },
    "subnet600NSG": {
      "type": "string",
      "defaultValue": "NSG_Services_600_VDC_Srvcs_tx",
      "metadata": {
        "description": "600: Services, Tier (0) Used to host highly sensit"
      }
    },
    "subnet600UDR": {
      "type": "string",
      "defaultValue": "UDR_600_Services",
      "metadata": {
        "description": "UDR 600 Services"
      }
    },
    "subnet601Prefix": {
      "type": "string",
      "defaultValue": "10.190.60.0/24",
      "metadata": {
        "description": "Used to host highly sensitive data that is also highly accessed."
      }
    },
    "subnet601Name": {
      "type": "string",
      "defaultValue": "LB_Services_601_VDC_Srvcs_TX",
      "metadata": {
        "description": "Used to host highly sensitive data that is also highly accessed."
      }
    },
    "subnet601NSG": {
      "type": "string",
      "defaultValue": "NSG_LB_Services_601_VDC_Srvcs_tx",
      "metadata": {
        "description": "601: LB_Services, Tier (0) Loadbalanced Services ("
      }
    },
    "subnet601UDR": {
      "type": "string",
      "defaultValue": "UDR_601_LB_Services",
      "metadata": {
        "description": "UDR 601 LB_Services"
      }
    },
    "subnet650Prefix": {
      "type": "string",
      "defaultValue": "10.190.58.0/24",
      "metadata": {
        "description": "Used to host public facing highly accecible workloads"
      }
    },
    "subnet650Name": {
      "type": "string",
      "defaultValue": "DMZ_650_VDC_Srvcs_tx",
      "metadata": {
        "description": "Used to host public facing highly accecible workloads"
      }
    },
    "subnet650NSG": {
      "type": "string",
      "defaultValue": "NSG_DMZ_650_VDC_Srvcs_tx",
      "metadata": {
        "description": "650: DMZ, Tier (0) Used to host public facing high"
      }
    },
    "subnet650UDR": {
      "type": "string",
      "defaultValue": "UDR_651_Services_DMZ",
      "metadata": {
        "description": "UDR 651 Services_DMZ"
      }
    },
    "subnet651Prefix": {
      "type": "string",
      "defaultValue": "10.190.57.0/24",
      "metadata": {
        "description": "Loadbalanced Services DMZ systems"
      }
    },
    "subnet651Name": {
      "type": "string",
      "defaultValue": "LB_DMZ_651_VDC_Srvcs_TX",
      "metadata": {
        "description": "Loadbalanced Services DMZ systems"
      }
    },
    "subnet651NSG": {
      "type": "string",
      "defaultValue": "NSG_LB_DMZ_651_VDC_Srvcs_tx",
      "metadata": {
        "description": "651: LB_DMZ, Data Tier (0) Loadbalanced Services D"
      }
    },
    "subnet651UDR": {
      "type": "string",
      "defaultValue": "UDR_651_Services_LB_DMZ",
      "metadata": {
        "description": "UDR 651 Services_LB_DMZ"
      }
    },
    "subnet660Prefix": {
      "type": "string",
      "defaultValue": "10.190.59.0/25",
      "metadata": {
        "description": "Tier 0 - Direct Control of enterprise identities in the environment. Tier 0 includes accounts, groups, and other assets that have direct or indirect administrative control of the Active Directory forest, domains, or domain controllers, and all the assets in it. The security sensitivity of all Tier 0 assets is equivalent as they are all effectively in control of each other."
      }
    },
    "subnet660Name": {
      "type": "string",
      "defaultValue": "User_Tier0_660_VDC_Srvcs_tx",
      "metadata": {
        "description": "Tier 0 - Direct Control of enterprise identities in the environment. Tier 0 includes accounts, groups, and other assets that have direct or indirect administrative control of the Active Directory forest, domains, or domain controllers, and all the assets in it. The security sensitivity of all Tier 0 assets is equivalent as they are all effectively in control of each other."
      }
    },
    "subnet660NSG": {
      "type": "string",
      "defaultValue": "NSG_User_Tier0_660_VDC_Srvcs_tx",
      "metadata": {
        "description": "660: User_Tier0, Tier (0) Tier 0 - Direct Control"
      }
    },
    "subnet660UDR": {
      "type": "string",
      "defaultValue": "UDR_660_User_Tier0",
      "metadata": {
        "description": "UDR 660: User_Tier0"
      }
    },
    "subnet661Prefix": {
      "type": "string",
      "defaultValue": "10.190.59.0/25",
      "metadata": {
        "description": "Tier 1 administrator - manage enterprise servers, services, and applications"
      }
    },
    "subnet661Name": {
      "type": "string",
      "defaultValue": "Users_Tier1_661_VDC_Srvcs_tx",
      "metadata": {
        "description": "Tier 1 administrator - manage enterprise servers, services, and applications"
      }
    },
    "subnet661NSG": {
      "type": "string",
      "defaultValue": "NSG_Users_Tier1_661_VDC_Srvcs_tx",
      "metadata": {
        "description": "661: Users_Tier1, Tier (1) Tier 1 administrator"
      }
    },
    "subnet661UDR": {
      "type": "string",
      "defaultValue": "UDR_661_User_Tier1",
      "metadata": {
        "description": "UDR 661: User_Tier1"
      }
    },
    "subnet799Prefix": {
      "type": "string",
      "defaultValue": "10.190.0.248/28",
      "metadata": {
        "description": "The Azure gateway network"
      }
    },
    "subnet799Name": {
      "type": "string",
      "defaultValue": "GW_799_VDC_gateway_St1",
      "metadata": {
        "description": "The Azure gateway network"
      }
    }
  },

  "variables": {
    "apiVersion": "2015-06-15",
    "templateBaseUrl": "https://raw.githubusercontent.com/willstg/azurefoundation/master/ARM/VNET"
  },

  "resources": [

    {
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Network/routeTables",
      "name": "[parameters('subnet101UDR')]",
      "location": "[resourceGroup().location]",
      "tags": {
        "displayName": "Subnet 101 UDR"
      },
      "properties": {
        "routes": [
          {
            "name": "RouteFrom101To102_IntASA_In",
            "properties": {
              "addressPrefix": "parameters('subnet102Prefix')]",
              "nextHopType": "VirtualAppliance",
              "nextHopIpAddress": "[parameters('subnet101VNAIP')]"
            }
          },

          {
            "name": "RouteFrom101To103_IntASA_Out",
            "properties": {
              "addressPrefix": "parameters('subnet103Prefix')]",
              "nextHopType": "VirtualAppliance",
              "nextHopIpAddress": "[parameters('subnet101VNAIP')]"
            }
          },

          {
            "name": "RouteFrom101To104_IntASA_DMZ",
            "properties": {
              "addressPrefix": "parameters('subnet104Prefix')]",
              "nextHopType": "VirtualAppliance",
              "nextHopIpAddress": "[parameters('subnet101VNAIP')]"
            }
          }

        ]
      }
    },
    {

      "apiVersion": "2015-06-15",

      "type": "Microsoft.Network/virtualNetworks",

      "name": "[parameters('vnetName')]",

      "location": "[resourceGroup().location]",

      "dependsOn": [
        "[concat('Microsoft.Network/networkSecurityGroups/', parameters('subnet101NSG'))]"
      
      ],
      "tags": {
        "displayName": "VDC VNet TX"
      },
      "properties": {
        "addressSpace": {
          "addressPrefixes": [
            "[parameters('vnetAddressPrefix')]"
          ]
        },
        "subnets": [
          {
            "name": "[parameters('subnet101Name')]",
            "properties": {
              "addressPrefix": "[parameters('subnet101Prefix')]",
              "networkSecurityGroup": {
                "id": "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('subnet101NSG'))]"
              },
              "routeTable": {
                "id": "[resourceId('Microsoft.Network/routeTables', parameters('subnet101UDR'))]"
              }
            }
          }      
        ]
      }
    }
  ]
}
